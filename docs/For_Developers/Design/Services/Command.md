# Command

Command service occupies one port of the port_handler. It is meant for short lived commands, primarily used during debugging and validation testing. Because of this it prioritizes ease of implementing commands above everything else.

## command_service

- měl by v kombinaci s podporou portů řešit většinu problémů s bývalým TestInterface
  - příkazy nejsou jediná forma komunikace se zařízením, jelikož obsazují pouze jeden port
- každý příkaz je specializace `command_base` třídy, takže je mnohem jednodušší držet persistent stav
- příkazy si stále vybírají kdy se ukončí podle návratové hodnoty `{ DONE, CONTINUE, ERR_ARGS, ERR_RUNTIME }` funkce `run`
- tady je právě další možné zlepšení, které aktuálně není implementováno - spuštění příkazu
  1. odeslání json stringu ve formátu CBOR na port `command_service`
  2. `command_service` kontroluje formát, hledá instanci podle názvu příkazu
  3. odpovídá ACK odesílateli, spouští příkaz na náhodném volném portu, číslo portu je v ACK
  4. spuštěný příkaz odesílá odpovědi z přiřazeného náhodného portu na požadovaný port odesílatele - předpokládá se, že odesílatel si tento port otevře před odesláním požadavku

```
zpráva z bodu 1.
{
  "cmd": "command name",
  "args": ["arg0", 1.0, "AwQF"],
  "port": 42,
  "id": 512
}
```
```
možné odpovědi z bodu 2.
{
  "cmd": "command name",
  "port": 123,
  "id": 512
}

{
  "cmd": "command name",
  "error": "args format"
}
```


## Command arguments


## Command result


## Calling commands

- command queries should be generated by instances of the command_client (also a service running on some other device for example)
    - this makes sense, commands should behave in this client 

